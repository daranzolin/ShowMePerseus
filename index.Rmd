---
title: "Show Me Perseus"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    theme: lumen
    source_code: embed
runtime:  shiny
---

```{r setup, include=FALSE}
library(tidyverse)
library(DT)
library(rperseus)
```

```{r global, include=FALSE}
source("utils.R")
```

Explore a Passage
==================================================================

Column {.sidebar}
-----------------------------------------------------------------------

```{r inputs}
selectInput("author", 
             "Author:",
            c("-", unique(perseus_catalog$group_name))
          )
conditionalPanel(condition = "input.author != '-'",
                uiOutput("text_ui")
                  )
conditionalPanel(condition = "input.text != '-'",
                uiOutput("language_ui")
                  )
```


```{r reactive-inputs}
  output$text_ui <- renderUI({
    selectInput(inputId = 'text', 
                label = 'Text:',
                c("-", perseus_catalog %>% 
                    filter(group_name %in% input$author) %>% 
                    pull(label) %>% 
                    unique))
    })

  output$language_ui <- renderUI({
    selectInput(inputId = 'language', 
                label = 'Language:',
                c("-", perseus_catalog %>% 
                    filter(group_name %in% input$author,
                           label %in% input$text) %>% 
                    pull(language) %>% 
                    unique))
    })
```

Row
-----------------------------------------------------------------------

```{r get-urn}
urn <- reactive(
  urn <- perseus_catalog %>% 
  filter(group_name == input$author,
         label == input$text,
         language == input$language) %>% 
  pull(urn) 
)
```
### Passage

```{r passage}


```


### Parsed Grammer Table

```{r grammer-tab}
DT::renderDataTable({
  parse_excerpt(urn(), "5.1-5.2")
}
)
```


Render Parallels
==================================================================

Column {.sidebar}
-----------------------------------------------------------------------

Column
-----------------------------------------------------------------------

### Parallels

```{r parallels}
renderPlot(
  tibble::tibble(label = c("Colossians", "1 Thessalonians", "Romans"),
              excerpt = c("1.4", "1.3", "8.35-8.39")) %>%
    dplyr::left_join(perseus_catalog) %>%
    dplyr::filter(language == "grc") %>%
    dplyr::select(urn, excerpt) %>%
    as.list() %>%
    purrr::pmap_df(get_perseus_text) %>%
    perseus_parallel(words_per_row = 4)
)
```